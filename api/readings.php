<?php require_once __DIR__.'/../lib/db.php'; header('Content-Type: application/json'); $did=isset($_GET['device_id'])?intval($_GET['device_id']):0; $limit=isset($_GET['limit'])?max(1,min(5000,intval($_GET['limit']))):1000; if($did<=0){ http_response_code(400); echo json_encode(['error'=>'device_id']); exit; } $s=db()->prepare('SELECT ts,weight_g,temp_c,hum_pct,seq FROM vcely_readings WHERE device_id=? ORDER BY id DESC LIMIT ?'); $s->bindValue(1,$did,PDO::PARAM_INT); $s->bindValue(2,$limit,PDO::PARAM_INT); $s->execute(); echo json_encode($s->fetchAll()); ?>